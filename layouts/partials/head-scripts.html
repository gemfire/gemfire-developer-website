<!-- Initialize GTM data layer -->
<script type="text/javascript">
    !function(){"use strict";!function(e,t){var n=e.amplitude||{_q:[],_iq:{}};if(n.invoked)e.console&&console.error&&console.error("Amplitude snippet has been loaded.");else{var r=function(e,t){e.prototype[t]=function(){return this._q.push({name:t,args:Array.prototype.slice.call(arguments,0)}),this}},s=function(e,t,n){return function(r){e._q.push({name:t,args:Array.prototype.slice.call(n,0),resolve:r})}},o=function(e,t,n){e[t]=function(){if(n)return{promise:new Promise(s(e,t,Array.prototype.slice.call(arguments)))}}},i=function(e){for(var t=0;t<y.length;t++)o(e,y[t],!1);for(var n=0;n<g.length;n++)o(e,g[n],!0)};n.invoked=!0;var a=t.createElement("script");a.type="text/javascript",a.integrity="sha384-TPZhteUkZj8CAyBx+GZZytBdkuKnhKsSKcCoVCq0QSteWf/Kw5Kb9oVFUROLE1l3",a.crossOrigin="anonymous",a.async=!0,a.src="https://cdn.amplitude.com/libs/analytics-browser-1.9.1-min.js.gz",a.onload=function(){e.amplitude.runQueuedFunctions||console.log("[Amplitude] Error: could not load SDK")};var c=t.getElementsByTagName("script")[0];c.parentNode.insertBefore(a,c);for(var u=function(){return this._q=[],this},l=["add","append","clearAll","prepend","set","setOnce","unset","preInsert","postInsert","remove","getUserProperties"],p=0;p<l.length;p++)r(u,l[p]);n.Identify=u;for(var d=function(){return this._q=[],this},f=["getEventProperties","setProductId","setQuantity","setPrice","setRevenue","setRevenueType","setEventProperties"],v=0;v<f.length;v++)r(d,f[v]);n.Revenue=d;var y=["getDeviceId","setDeviceId","getSessionId","setSessionId","getUserId","setUserId","setOptOut","setTransport","reset"],g=["init","add","remove","track","logEvent","identify","groupIdentify","setGroup","revenue","flush"];i(n),n.createInstance=function(e){return n._iq[e]={_q:[]},i(n._iq[e]),n._iq[e]},e.amplitude=n}}(window,document)}();
</script>


<script>
dataLayer = [];
window.process = { browser: true, env: { ENVIRONMENT: 'BROWSER' } };
</script>
<!-- OneTrust -->
{{ if eq (getenv "HUGO_ENV") "production" }}
<meta content='688714c5-a2c1-45ed-8486-25d404752d6e' name='onetrust-data-domain'>
<meta content='https://tags.tiqcdn.com/utag/vmware/microsites-privacy/prod/utag.js' name='microsites-utag'>
<script>
    amplitude.init('the-key', undefined, { defaultTracking: { sessions: true, pageViews: true, formInteractions: true, fileDownloads: true }});
    console.log("amplitude initialized again");
</script>
{{ else }}
<meta content='688714c5-a2c1-45ed-8486-25d404752d6e-test' name='onetrust-data-domain'>
<meta content='https://tags.tiqcdn.com/utag/vmware/microsites-privacy/qa/utag.js' name='microsites-utag'>
{{ end }}
<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
<script src='https://www.vmware.com/files/templates/inc/utag_data.js'></script>
{{ if eq (getenv "HUGO_ENV") "production" }}
<script src='https://tags.tiqcdn.com/utag/vmware/microsites-privacy/prod/utag.sync.js'></script>
{{ else }}
<script src='https://tags.tiqcdn.com/utag/vmware/microsites-privacy/qa/utag.sync.js'></script>
{{ end }}
<script>
function OptanonWrapper() { { window.dataLayer.push({ event: 'OneTrustGroupsUpdated' }); } }
</script>
<!-- Google Tag Manager -->
<script>
    amplitude.track('Environment Var', { json: true});
    console.log("amplitude tracked");
// function setGTM(w,d,s,l,i){ w[l]=w[l]||[]; w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'}); var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:''; j.async=true; j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); }
// if (document.cookie.indexOf('OptanonConsent') > -1 && document.cookie.indexOf('groups=') > -1) { setGTM(window,document,'script','dataLayer','GTM-TQ9H33K'); } else{ waitForOnetrustActiveGroups(); } var timer; function waitForOnetrustActiveGroups() { if (document.cookie.indexOf('OptanonConsent') > -1 && document.cookie.indexOf('groups=') > -1) { clearTimeout(timer); setGTM(window,document,'script','dataLayer','GTM-TQ9H33K'); } else{ timer=setTimeout(waitForOnetrustActiveGroups, 250); } }
</script>

<!-- Sentry SDK-->
<!--<script-->
<!--  src="https://browser.sentry-cdn.com/7.27.0/bundle.tracing.min.js"-->
<!--  integrity="sha384-9DbxFQbHqgid8ADllNDRZcmsuQRYnnDVDkw+5/e8VzfpHAiIZM71uGj+p3CVeheW"-->
<!--  crossorigin="anonymous"-->
<!--&gt;</script>-->

<script>
<!--Sentry.init({-->
<!--  dsn: "https://91138cf7f17842fd8a57d45372bf538c@o448817.ingest.sentry.io/5712977",-->
<!--  integrations: [new Sentry.Integrations.BrowserTracing()],-->
<!--  release: '{{ getenv "COMMIT_REF" }}',-->
<!--  environment: '{{ getenv "CONTEXT" }}',-->
<!--  // We recommend adjusting this value in production, or using tracesSampler-->
<!--  // for finer control-->
<!--  tracesSampleRate: 0.2,-->
<!--  beforeSend: function(event, hint) {-->
<!--    var gtm = false;-->
<!--    try {-->
<!--      if (hint.originalException.stack)-->
<!--        gtm = hint.originalException.stack.indexOf('www.googletagmanager.com/gtm.js?id=') > -1;-->
<!--    } catch (error) {-->
<!--      console.error(error);-->
<!--    }-->
<!--    event.tags = event.tags || {};-->
<!--    if (gtm) {-->
<!--      event.tags.logger = 'gtm';-->
<!--    }-->
<!--    event.tags.logger = event.tags.logger || '_default_';-->
<!--    event.extra = event.extra || {};-->
<!--    if (gtm) {-->
<!--      event.tags.logger = 'gtm';-->
<!--      event.extra.dataLayer = dataLayer.map(-->
<!--        function(i) {-->
<!--          try {-->
<!--            return JSON.stringify(i, null, ' ');-->
<!--          } catch(error) {-->
<!--            return '[cannot be serialized]: ' + error.message;-->
<!--          }-->
<!--        }-->
<!--      );-->
<!--    }   -->
<!--    return event;-->
<!--  }-->
<!--});-->
// localStorage.clear();


function sendAmplitudeEventOnLoad(eventType, eventProperties) {
    console.log("onload API key: " + process.env.AMPLITUDE_API_KEY + " hugo: " + process.env.HUGO_ENV);
    if (process.env.AMPLITUDE_API_KEY) {
        console.log("sending onload: " + eventType + eventProperties);
        $(window).on('load', function (e) {
            dataLayer.push({'event': 'logEvent', 'eventType': eventType, 'eventProperties': eventProperties});
        });
    }
}
function sendAmplitudeEvent(eventType, eventProperties) {
    console.log("event API key: " + process.env.AMPLITUDE_API_KEY + " hugo: " + process.env.HUGO_ENV);
    if (process.env.AMPLITUDE_API_KEY) {
        console.log("sending event: " + eventType + eventProperties);
        track(eventType, eventProperties,
            {
                user_id: 'datamonster@gmail.com',
            },
        )
    }
}

function sendAmplitudeUserPropsOnLoad(userProperties) {
  // $(window).on('load', function(e){dataLayer.push({'event': 'setUserProperties', 'userProperties': userProperties});});
}
function sendAmplitudeUserProps(userProperties) {
  // dataLayer.push({'event': 'setUserProperties', 'userProperties': userProperties});
}
function setAmplitudeUserId(userId) {
  // dataLayer.push({'event': 'setUserId', 'userId': userId});
}

function getCookie(name) {
  var dc = document.cookie;
  var prefix = name + "=";
  var begin = dc.indexOf("; " + prefix);
  if (begin == -1) {
    begin = dc.indexOf(prefix);
    if (begin != 0) return null;
  } else {
    begin += 2;
    var end = document.cookie.indexOf(";", begin);
    if (end == -1) {
      end = dc.length;
    }
  }

  return decodeURI(dc.substring(begin + prefix.length, end));
}

  function updateFilters() {
      let activeFilters = Array.from(document.querySelectorAll('li.filter.active')).map(el => el.getAttribute("filter"))
      if(activeFilters.length === 0) {
        document.querySelectorAll('[filter="all"]')[0].classList.add("active")
        activeFilters = ["all"]
      }
      const params = new URLSearchParams(document.location.search.substring(1));
      params.delete('filters')
      const constructedParams = Array.from(params).length > 0 ? "&" + params.toString() : ''
      window.history.pushState('', '', '?filters=' + activeFilters.join(",") + constructedParams);
      
      Array.from(document.getElementsByClassName("filter-item")).forEach(el => {
        el.hidden = true
        for (f of activeFilters) {
          if (el.classList.contains(f) | f === 'all') {
            el.hidden = false
            break;
          }
        }
      });
    }

    document.addEventListener("DOMContentLoaded", function () {
      const params = new URLSearchParams(document.location.search.substring(1));
      let fs = params.get("filters")
      if (fs) {
        fs = fs.toLowerCase().split(',')
        Array.from(document.getElementsByClassName("filter")).forEach(el => {
          if (fs.includes(el.getAttribute("filter"))) {
            el.classList.add("active")
          } else {
            el.classList.remove("active")
          }
        });
        updateFilters()
      }

    });

</script>